<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Área do Aluno - 2EHC Treinamentos</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    @font-face {
      font-family: 'Organetto';
      src: url('public/fonts/Fontspring-DEMO-organetto-regular.otf') format('opentype');
      font-weight: normal;
    }

    @font-face {
      font-family: 'Organetto';
      src: url('public/fonts/Fontspring-DEMO-organetto-light.otf') format('opentype');
      font-weight: 300;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Organetto', 'Inter', Arial, sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      color: #1e293b;
      min-height: 100vh;
    }

    .header {
      background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
      color: white;
      padding: 20px 40px;
      box-shadow: 0 4px 20px rgba(30, 58, 138, 0.3);
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo {
      width: 60px;
      height: 60px;
      border-radius: 8px;
    }

    .header-title {
      font-family: 'Organetto', sans-serif;
      font-weight: 300;
      font-size: 24px;
    }

    .nav-buttons {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .nav-btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .nav-btn:hover {
      background: rgba(220, 38, 38, 0.3);
    }

    .user-info {
      color: white;
      font-size: 14px;
      margin-right: 15px;
    }

    .user-name {
      font-weight: 600;
      color: #fbbf24;
    }

    .container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    }

    .welcome-section {
      background: white;
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .welcome-section h2 {
      color: #1e3a8a;
      margin-bottom: 15px;
      font-size: 28px;
      font-family: 'Organetto', sans-serif;
      font-weight: 300;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      margin-bottom: 40px;
    }

    .card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card h3 {
      color: #1e3a8a;
      margin-bottom: 20px;
      font-size: 24px;
      font-family: 'Organetto', sans-serif;
      font-weight: normal;
      border-bottom: 2px solid #dc2626;
      padding-bottom: 10px;
    }

    .cursos-section {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .curso-item {
      background: #f8fafc;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      border-left: 4px solid #1e3a8a;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .curso-info h4 {
      color: #1e3a8a;
      font-size: 18px;
      margin-bottom: 5px;
      font-family: 'Organetto', sans-serif;
    }

    .curso-status {
      color: #64748b;
      font-size: 14px;
    }

    .assistir-btn {
      background: linear-gradient(135deg, #dc2626, #b91c1c);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .assistir-btn:hover {
      background: linear-gradient(135deg, #b91c1c, #991b1b);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(220, 38, 38, 0.3);
    }

    .assistir-btn:disabled {
      background: #94a3b8;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e2e8f0;
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-label {
      font-weight: 500;
      color: #374151;
    }

    .info-value {
      color: #64748b;
    }

    .certificados-section {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .certificado-item {
      background: #f0fdf4;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      border-left: 4px solid #16a34a;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .download-btn {
      background: #16a34a;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .download-btn:hover {
      background: #15803d;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #64748b;
    }

    @media (max-width: 768px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .header-content {
        flex-direction: column;
        gap: 20px;
      }
      
      .curso-item {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="header-content">
      <div class="logo-container">
        <img src="logo2ehc.png" alt="Logo 2EHC" class="logo">
        <h1 class="header-title">Área do Aluno</h1>
      </div>
      <div class="nav-buttons">
        <div class="user-info">
          Olá, <span class="user-name" id="userName">Aluno</span>
        </div>
        <a href="index.html" class="nav-btn">← Voltar</a>
        <button class="nav-btn" onclick="logout()">Sair</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="welcome-section">
      <h2 id="welcomeMessage">Bem-vindo!</h2>
      <p>Acesse seus cursos, acompanhe seu progresso e baixe seus certificados.</p>
    </div>

    <div class="dashboard-grid">
      <div class="card">
        <h3>Meus Dados</h3>
        <div id="dadosAluno"></div>
      </div>

      <div class="card">
        <h3>Progresso</h3>
        <div class="info-item">
          <span class="info-label">Cursos Liberados:</span>
          <span class="info-value" id="cursosLiberados">0</span>
        </div>
        <div class="info-item">
          <span class="info-label">Cursos Concluídos:</span>
          <span class="info-value" id="cursosConcluidos">0</span>
        </div>
        <div class="info-item">
          <span class="info-label">Certificados:</span>
          <span class="info-value" id="certificadosCount">0</span>
        </div>
      </div>
    </div>

    <div class="cursos-section">
      <h3>Meus Cursos</h3>
      <div id="listaCursos"></div>
    </div>

    <div class="certificados-section">
      <h3>Meus Certificados</h3>
      <div id="listaCertificados"></div>
    </div>

    <div class="card">
      <h3>Financeiro</h3>
      <div class="info-item">
        <span class="info-label">Status:</span>
        <span class="info-value" style="color: #16a34a;">Em dia</span>
      </div>
      <div class="info-item">
        <span class="info-label">Próximo vencimento:</span>
        <span class="info-value">Não há pendências</span>
      </div>
    </div>
  </div>

  <script>
    // Verificar se está logado
    let alunoData = null;
    
    function verificarLogin() {
      // Verificar se há token no localStorage
      const token = localStorage.getItem('alunoToken');
      if (!token) {
        console.log('Token não encontrado');
        window.location.href = 'login-aluno.html';
        return;
      }

      // Buscar dados do aluno no backend usando o token
      buscarDadosAluno();
    }

    async function buscarDadosAluno() {
      try {
        const response = await fetch('http://localhost:3000/api/aluno/dados', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('alunoToken')}`,
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          alunoData = await response.json();
          initializeAluno();
        } else {
          // Se não conseguir buscar dados, usar dados básicos
          const email = localStorage.getItem('userEmail') || 'aluno@email.com';
          alunoData = {
            nome: email.split('@')[0], // Usar parte do email como nome
            email: email,
            cpf: '***.***.***-**',
            dataNascimento: '--/--/----',
            cursosLiberados: [],
            certificados: []
          };
          initializeAluno();
        }
      } catch (error) {
        console.error('Erro ao buscar dados:', error);
        // Usar dados básicos em caso de erro
        const email = localStorage.getItem('userEmail') || 'aluno@email.com';
        alunoData = {
          nome: email.split('@')[0],
          email: email,
          cpf: '***.***.***-**',
          dataNascimento: '--/--/----',
          cursosLiberados: [],
          certificados: []
        };
        initializeAluno();
      }
    }



    function initializeAluno() {
      // Mostrar nome do aluno
      const nomeAluno = alunoData.nome || alunoData.nomeAluno || 'Aluno';
      document.getElementById('welcomeMessage').textContent = `Bem-vindo, ${nomeAluno}!`;
      document.getElementById('userName').textContent = nomeAluno;
      
      // Mostrar dados do aluno
      const dadosContainer = document.getElementById('dadosAluno');
      dadosContainer.innerHTML = `
        <div class="info-item">
          <span class="info-label">Nome:</span>
          <span class="info-value">${nomeAluno}</span>
        </div>
        <div class="info-item">
          <span class="info-label">E-mail:</span>
          <span class="info-value">${alunoData.email}</span>
        </div>
        <div class="info-item">
          <span class="info-label">CPF:</span>
          <span class="info-value">***********</span>
        </div>
      `;
      
      renderCursos();
      renderCertificados();
      updateProgress();
    }

    function renderCursos() {
      const container = document.getElementById('listaCursos');
      const cursosLiberados = alunoData.cursosLiberados || [];
      
      if (cursosLiberados.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h4>Nenhum curso liberado ainda</h4>
            <p>Entre em contato com sua empresa para liberar cursos.</p>
          </div>
        `;
        return;
      }

      container.innerHTML = cursosLiberados.map(curso => `
        <div class="curso-item">
          <div class="curso-info">
            <h4>${curso}</h4>
            <div class="curso-status">Disponível para assistir</div>
          </div>
          <button class="assistir-btn" onclick="assistirCurso('${curso}')">
            Assistir Curso
          </button>
        </div>
      `).join('');
    }

    function renderCertificados() {
      const container = document.getElementById('listaCertificados');
      const certificados = alunoData.certificados || [];
      
      if (certificados.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h4>Nenhum certificado disponível</h4>
            <p>Complete os cursos para gerar seus certificados.</p>
          </div>
        `;
        return;
      }

      container.innerHTML = certificados.map(cert => `
        <div class="certificado-item">
          <div>
            <strong>${cert.curso}</strong><br>
            <small>Emitido em: ${new Date(cert.dataEmissao).toLocaleDateString('pt-BR')}</small>
          </div>
          <button class="download-btn" onclick="downloadCertificado('${cert.id}')">
            Download
          </button>
        </div>
      `).join('');
    }

    function updateProgress() {
      const cursosLiberados = alunoData.cursosLiberados || [];
      const certificados = alunoData.certificados || [];
      
      document.getElementById('cursosLiberados').textContent = cursosLiberados.length;
      document.getElementById('cursosConcluidos').textContent = certificados.length;
      document.getElementById('certificadosCount').textContent = certificados.length;
    }

    window.assistirCurso = function(nomeCurso) {
      // Mapear nomes dos cursos para arquivos
      const cursoFiles = {
        'NR-18': 'curso_nr18.html',
        'NR-34 (16h)': 'curso_nr34.html',
        'NR-34 (8h)': 'curso_nr34.html',
        'NR-5 (40h)': 'curso_nr5.html',
        'NR-5 (20h)': 'curso_nr5.html',
        'NR-1 Integração': 'curso_nr1.html',
        'NR-6 EPI': 'curso_nr6.html',
        'NR-11': 'curso_nr11.html',
        'NR-10': 'curso_nr10.html',
        'NR-17': 'curso_nr17.html',
        'NR-35': 'curso_nr35.html',
        'Brigada de Incêndio': 'curso_brigada.html'
      };
      
      const arquivo = cursoFiles[nomeCurso] || 'curso_nr17.html';
      window.open(arquivo, '_blank');
    };

    window.downloadCertificado = function(certId) {
      alert('Download do certificado iniciado!');
      // Aqui você implementaria o download real do certificado
    };

    window.logout = function() {
      // Limpar dados do localStorage
      localStorage.removeItem('alunoToken');
      localStorage.removeItem('alunoLogado');
      
      // Redirecionar para página inicial
      window.location.href = 'index.html';
    };

    // Inicializar página
    verificarLogin();
  </script>

</body>
</html>